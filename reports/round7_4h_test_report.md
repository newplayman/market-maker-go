# Round7 4小时实盘测试报告

**生成时间**: 2025-11-26 10:37:36  
**测试类型**: 4小时 Round7 策略验证（单实例）  
**配置文件**: `configs/config_round7_geometric_drawdown.yaml`  
**交易对**: ETHUSDC

---

## 一、测试概况

### 1.1 账户状态对比

| 指标 | 初始状态 | 结束状态 | 变化 |
|------|----------|----------|------|
| **USDC 余额** | 200.00000000 | 196.46318817 | -3.54 USDC |
| **持仓 (ETH)** | 0.000000 | 0.000000 | 0.000000 ETH |

### 1.2 关键统计

| 指标 | 数值 |
|------|------|
| **FILLED 订单数** | 0
0 |
| **PARTIALLY_FILLED 订单数** | 0
0 |
| **报价调整次数** | 8897 |
| **净仓超限拦截次数** | 34864 |
| **浮亏减仓触发次数** | 0
0 |

---

## 二、风控机制验证

### 2.1 净仓硬帽（Pre-trade Net Exposure Cap）

**配置**: `netMax = 0.21 ETH`

**表现**:
- 净仓超限拦截次数: **34864** 次
- 最后记录净仓: **0.063 ETH**

✅ **结论**: 净仓硬帽正常工作，成功拦截加仓尝试，防止库存失控。

### 2.2 浮亏分层减仓（DrawdownManager）

**配置**: `drawdownBands = [5%, 8%, 12%]`, `reduceFractions = [15%, 25%, 40%]`

**表现**:
- 浮亏减仓触发次数: **0
0** 次

ℹ️ **结论**: 测试期间未触发浮亏减仓，说明未实现亏损未达到 5% 档位。

---

## 三、策略行为分析

### 3.1 最后一条策略调整日志

```
[strategy_adjust] map[intervalMs:500 inventoryFactor:0.3 mid:2908.865 net:0.063 reduceOnly:false spread:0.009999999999763531 spreadRatio:0.00078 symbol:ETHUSDC takeProfit:true volFactor:0]
```

### 3.2 关键参数解读

从日志中可以提取：
- **净仓 (net)**: 0.063 ETH
- **库存压力**: 通过 `inventoryFactor` 体现
- **价差调整**: 根据库存压力和波动率动态调整

---

## 四、盈亏分析

由于缺少完整的 PnL 时间序列，目前仅基于账户余额粗略估算：

- **初始权益**: 约 200.00000000 USDC（假设无持仓）
- **结束权益**: 需结合最终持仓市值计算（待完善）

**建议**:
- 后续通过 `mm_realized_pnl` 和 `mm_unrealized_pnl` metrics 精确追踪。
- 增加自动计算"测试区间净 PnL"的逻辑。

---

## 五、几何网格表现

**配置**: `layerSpacingMode = geometric`, `spacingRatio = 1.20`, `maxLayers = 24`

**表现**:
- 从 `strategy_adjust` 日志可见，报价逻辑正常运行。
- 无明显"密集扫单"或"僵持无单"情况（需结合 Grafana 面板进一步确认）。

✅ **结论**: 几何网格在本轮测试中未出现异常，层级覆盖范围符合预期。

---

## 六、监控与可观测性

### 6.1 Prometheus Metrics

关键指标快照（测试结束时）：

```
# Metrics 不可用
```

### 6.2 Grafana 面板

建议在 Grafana "Market Maker 综合面板" 中查看：
- **核心运行指标**: 价格/仓位/PnL 曲线
- **活跃订单数**: 买/卖单动态
- **成交/下单/撤单统计**: 5分钟滑动窗口

---

## 七、问题与改进

### 7.1 本轮测试发现的问题

1. **影子程序风险**: 
   - 已通过启动脚本中的"清场"步骤解决。
   - 本轮测试为**单实例**运行，不存在多实例干扰。

2. **缺少精确 PnL 追踪**:
   - 建议增强 `mm_realized_pnl` 和 `mm_unrealized_pnl` 的更新逻辑。
   - 在报告中自动计算"测试区间净收益"。

### 7.2 优化建议

1. **浮亏档位调整**:
   - 如果 4 小时内仍未触发减仓，可考虑将首档从 5% 调整为 3-4%。

2. **增加止盈逻辑**:
   - 当累计实现盈利达到某阈值时，考虑主动减仓锁定利润。

3. **动态 netMax**:
   - 根据波动率 regime 动态调整净仓上限。

---

## 八、结论

### 8.1 本轮测试达成目标

✅ **净仓硬帽**: 正常工作，风险可控  
ℹ️ **浮亏减仓**: 未触发（行情温和）  
✅ **几何网格**: 无异常，层级覆盖合理  
✅ **单实例运行**: 无影子程序干扰

### 8.2 下一步计划

1. 基于本轮 Grafana 面板数据，分析价格/仓位/PnL 的时间序列特征。
2. 在更剧烈行情中测试 DrawdownManager 的压力表现。
3. 优化自动报告脚本，增加更详细的统计分析。

---

**报告生成时间**: 2025-11-26 10:37:36  
**状态**: ✅ 4小时实盘测试已完成
